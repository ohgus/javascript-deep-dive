# 📢 실행 컨텍스트 23.6.3 ~ 23.7 발표

## 📝 23.6 실행 컨텍스트의 생성과 식별자 검색 과정

### ✏️ 전역 코드 실행

전역 코드의 평가가 완료되면 전역 코드가 순차적으로 실행되는데 이때 전역 변수의 값을 할당하거나, 함수를 호출한다. 만약 함수나 변수의 식별자가 선언되지 않은 식별자라면 에러가 발생한다.

식별자는 스코프가 다르면 여러개 존재할 수 있기 때문에 어느 스코프의 식별자를 참조할지 결정해야 한다. 이를 `식별자 결정`이라 한다. 식별자 걸정을 위해 식별자를 검색할 때는 실행 중인 컨텍스트에서 검색을 시작한다.  
실행 중인 컨텍스트에서 식별자를 검색할 수 없으면 상위 스코프로 이동하여 식별자를 검색한다. -> 스코프 체인의 동작 원리  
스코프 체인의 종점인 전역 렉시컬 환경에서 검색할 수 없는 식별자는 참조 에러를 발생시킨다.

실행 컨텍스트는 소스코드를 실행하기 위해 필요한 환경을 제공하고 코드의 실행 결과를 실제로 관리하는 영역.

### ✏️ 함수 코드 평가

전역 코드를 실행하다가 함수를 호출하게 되면 전역 코드의 실행을 일시 중단하고 함수 내부로 코드의 제어권이 이동하여 함수 코드를 평가하기 시작한다.

#### 💡 함수 코드 평가 순서

1. 함수 실행 컨텍스트 생성 - 함수 실행 컨텍스트를 생성하고 함수 렉시컬 환경이 완성되면 실행 컨텍스트 스택에 푸시된다. 함수 실행 컨텍스트가 스택의 최상단이 되어 실행 중인 실행 컨텍스트가 된다.

2. 함수 렉시컬 환경 생성 - 함수 렉스컬 환경을 생성하고 함수 실행 컨텍스트에 바인딩한다.

   1. 함수 환경 레코드 생성 - 함수 렉시컬 환경을 구성하는 컴포넌트 중 하나로 매개변수, `arguments` 객체, 함수 내부에서 선언된 지역 변수, 중첩 함수를 등록하고 관리한다.

   2. `this` 바인딩 - `[[ThisValue]]` 내부 슬롯에 `this`가 바인딩된다. (`바인딩될 객체는 함수 호출 방식에 의해 결정된다.`)

   3. 외부 렉시컬 환경에 대한 참조 결정 - 함수 정의를 평가하여 함수 객체를 생성할 때 함수의 상위 스코프를 `[[Environment]]`에 저장한다. 함수 렉시컬 환경의 외부 렉시컬 환경에 대한 참조에 할당되는 것은 `[[Environment]]`에 저장된 렉시컬 환경의 참조다. `[[Environment]]가 렉시컬 스코프를 구현하는 메커니즘`

### ✏️ 함수 코드 실행

함수 내부에 선언된 변수에 값을 할당하고 중첩 함수가 있으면 중첩 함수를 호출한다. 식별자 결정을 할때 실행 중인 실행 컨텍스트의 렉시컬 환경에서 식별자를 검색하기 시작한다.

만약 중첩 함수가 존재한다면 함수 코드의 평가, 실행, 종료 과정을 반복한다.

### ✏️ 함수 코드 실행 종료

함수 코드의 실행이 종료되면 실행 컨텍스트 스택에서 제거되고 다음 실행 컨텍스트가 실행 중인 실행 컨텍스트가 된다. 실행 컨텍스트가 스택에서 제거되어도 함수의 렉시컬 환경까지 즉시 소멸되는 것이 아니라 누군가 참조하는 동안은 소멸되지 않는다. 참조가 종료 되었을 때 가비지 컬렉터에 의해 메모리 공간의 확보가 해제되어 소멸된다.

### ✏️ 전역 코드 실행 종료

더 이상 실행할 코드가 없으면 전역 코드의 실행이 종료되고 전역 실행 컨텍스트를 스택에서 제거한다.
